<!-- templates/loan_app/loan_ticket_detail.html -->
{% extends 'base.html' %}

{% block title %}Loan Ticket Details - {{ loan_ticket.id }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="mb-0">Loan Ticket Details: #{{ loan_ticket.id }}</h1>
    <div>
        <a href="{% url 'loan_ticket_update' loan_ticket.pk %}" class="btn btn-warning me-2">
            <i class="fas fa-edit me-1"></i>Edit
        </a>
        <a href="{% url 'loan_ticket_delete' loan_ticket.pk %}" class="btn btn-danger">
            <i class="fas fa-trash-alt me-1"></i>Delete
        </a>
    </div>
</div>

<div class="card shadow-sm mb-4">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0">Loan Information</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <p><strong>Borrower:</strong> <a href="{% url 'borrower_detail' loan_ticket.borrower.pk %}">{{ loan_ticket.borrower.first_name }} {{ loan_ticket.borrower.last_name }}</a></p>
                <p><strong>Loan Type:</strong> {{ loan_ticket.loan_type }}</p>
                <p><strong>Loan Amount:</strong> ${{ loan_ticket.loan_amount|floatformat:2 }}</p>
                <p><strong>Loan Tenure:</strong> {{ loan_ticket.loan_tenure_in_months }} months</p>
            </div>
            <div class="col-md-6">
                <p><strong>Interest Rate:</strong> {{ loan_ticket.interest_rate|floatformat:2 }}%</p>
                <p><strong>Start Date:</strong> {{ loan_ticket.start_date|date:"Y-m-d H:i" }}</p>
                <p><strong>End Date:</strong> {{ loan_ticket.end_date|date:"Y-m-d H:i" }}</p>
                <p><strong>Status:</strong> <span class="badge bg-{% if loan_ticket.status == 'Ongoing' %}primary{% elif loan_ticket.status == 'Approved' %}success{% elif loan_ticket.status == 'Rejected' %}danger{% elif loan_ticket.status == 'Completed' %}secondary{% else %}warning{% endif %}">{{ loan_ticket.status }}</span></p>
            </div>
        </div>
        <hr>
        <p><strong>Remark:</strong> {{ loan_ticket.remark|default:"N/A" }}</p>
        <p><strong>Created At:</strong> {{ loan_ticket.created_at|date:"Y-m-d H:i" }}</p>
    </div>
</div>

<div class="card shadow-sm mb-4">
    <div class="card-header bg-info text-white">
        <h5 class="mb-0">EMIs for this Loan Ticket</h5>
    </div>
    <div class="card-body">
        {% if loan_ticket.emis.all %}
            <div class="table-responsive">
                <table class="table table-striped table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>EMI No.</th>
                            <th>Amount</th>
                            <th>Outstanding</th>
                            <th>Status</th>
                            <th>Start Date</th>
                            <th>End Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for emi in loan_ticket.emis.all %}
                            <tr>
                                <td>{{ emi.emi_no }}</td>
                                <td>${{ emi.emi_amount|floatformat:2 }}</td>
                                <td>${{ emi.outstanding_amount|floatformat:2 }}</td>
                                <td><span class="badge bg-{% if emi.status == 'Pending' %}warning{% elif emi.status == 'Paid' %}success{% elif emi.status == 'Overdue' %}danger{% else %}info{% endif %}">{{ emi.status }}</span></td>
                                <td>{{ emi.start_date|date:"Y-m-d" }}</td>
                                <td>{{ emi.end_date|date:"Y-m-d" }}</td>
                                <td>
                                    <a href="{% url 'emi_detail' emi.pk %}" class="btn btn-info btn-sm" title="View EMI Details">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p class="text-center">No EMIs found for this loan ticket.</p>
        {% endif %}
    </div>
</div>

<div class="text-center mt-4">
    <a href="{% url 'loan_ticket_list' %}" class="btn btn-secondary"><i class="fas fa-arrow-left me-2"></i>Back to Loan Tickets</a>
</div>
{% endblock %}
